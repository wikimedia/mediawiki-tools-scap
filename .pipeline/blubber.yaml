# A Blubber spec file for a Docker container, based on Debian 9
# (stretch), where the Scap automated test suite can be run. This uses
# Debian packages to provide Scap dependencies, as those are what are
# used in production as well.
#
# Note that the package lists should match those in debian/control in
# the Scap source tree.

version: v4
base: docker-registry.wikimedia.org/wikimedia-stretch
apt:
  packages:
    - git
    - php-cli
    - python-concurrent.futures
    - python-configparser
    - python-dev
    - python-jinja2
    - python-requests
    - python-yaml
    - python2.7
runs:
  environment:
    LANG: C.UTF-8


variants:
  build:
    copies: [local]
    apt:
      packages:
        - bash-completion
        - build-essential
        - ca-certificates
        - openssl
        - python2.7-dev
        - python-openssl
        - python-setuptools
        - zlib1g-dev
        - libjpeg-dev
        - flake8
        - python-coverage
        - python-mock
        - python-psutil
        - python-pygments
        - python-sphinx
        - python-sphinxcontrib.actdiag
        - python-sphinxcontrib.blockdiag
        - python-sphinxcontrib.programoutput
        - python-pytest
        - python-pytest-cov
        - python-pytest-mock
  test:
    includes: [build]
    entrypoint: [scripts/check]
    runs:
      insecurely: True
