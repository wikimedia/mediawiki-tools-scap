# A Blubber spec file for a Docker container, based on Debian 9
# (stretch), where the Scap automated test suite can be run. This uses
# Debian packages to provide Scap dependencies, as those are what are
# used in production as well.
#
# Note that the package lists should match those in debian/control in
# the Scap source tree.

version: v4
base: docker-registry.wikimedia.org/wikimedia-stretch
apt:
  packages:
    - bash-completion
    - flake8
    - git
    - php-cli
    - python3
    - python3-jinja2
    - python3-pygments
    - python3-pytest
    - python3-pytest-mock
    - python3-requests
    - python3-sphinx
    - python3-sphinxcontrib.actdiag
    - python3-sphinxcontrib.blockdiag
    - python3-sphinxcontrib.programoutput
    - python3-yaml
runs:
  environment:
    LANG: C.UTF-8


variants:
  build:
    copies: [local]
    apt:
      packages:
        - bash-completion
        - build-essential
        - ca-certificates
        - flake8
        - libjpeg-dev
        - openssl
        - python3
        - python3-jinja2
        - python3-pygments
        - python3-pytest
        - python3-pytest-mock
        - python3-requests
        - python3-sphinx
        - python3-sphinxcontrib.actdiag
        - python3-sphinxcontrib.blockdiag
        - python3-sphinxcontrib.programoutput
        - python3-yaml
        - zlib1g-dev
        - shellcheck
  test:
    includes: [build]
    entrypoint: [scripts/check]
    runs:
      insecurely: True
